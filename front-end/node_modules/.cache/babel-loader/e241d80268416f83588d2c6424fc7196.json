{"remainingRequest":"D:\\projectFPT\\SolidityProject\\front-end\\node_modules\\babel-loader\\lib\\index.js!D:\\projectFPT\\SolidityProject\\front-end\\node_modules\\eslint-loader\\index.js??ref--13-0!D:\\projectFPT\\SolidityProject\\front-end\\src\\router\\middlewares.js","dependencies":[{"path":"D:\\projectFPT\\SolidityProject\\front-end\\src\\router\\middlewares.js","mtime":1634524960271},{"path":"D:\\projectFPT\\SolidityProject\\front-end\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\projectFPT\\SolidityProject\\front-end\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\projectFPT\\SolidityProject\\front-end\\node_modules\\eslint-loader\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmluZCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LnNvbWUiOwppbXBvcnQgInJlZ2VuZXJhdG9yLXJ1bnRpbWUvcnVudGltZSI7CmltcG9ydCBfYXN5bmNUb0dlbmVyYXRvciBmcm9tICJEOi9wcm9qZWN0RlBUL1NvbGlkaXR5UHJvamVjdC9mcm9udC1lbmQvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2FzeW5jVG9HZW5lcmF0b3IiOwppbXBvcnQgJHN0b3JlIGZyb20gJy4uL3N0b3JlJzsKaW1wb3J0IHsgQXV0aFNlcnZpY2UgfSBmcm9tICdAL3NlcnZpY2VzL2F1dGguanMnOwppbXBvcnQgY29va2llIGZyb20gJ3Z1ZS1jb29raWVzJzsKZXhwb3J0IGZ1bmN0aW9uIGluaXRDdXJyZW50VXNlclN0YXRlTWlkZGxld2FyZShfeCwgX3gyLCBfeDMpIHsKICByZXR1cm4gX2luaXRDdXJyZW50VXNlclN0YXRlTWlkZGxld2FyZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwp9CgpmdW5jdGlvbiBfaW5pdEN1cnJlbnRVc2VyU3RhdGVNaWRkbGV3YXJlKCkgewogIF9pbml0Q3VycmVudFVzZXJTdGF0ZU1pZGRsZXdhcmUgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUodG8sIGZyb20sIG5leHQpIHsKICAgIHZhciBjdXJyZW50VXNlcklkOwogICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUkKF9jb250ZXh0KSB7CiAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgc3dpdGNoIChfY29udGV4dC5wcmV2ID0gX2NvbnRleHQubmV4dCkgewogICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICBjdXJyZW50VXNlcklkID0gJHN0b3JlLnN0YXRlLnVzZXIuY3VycmVudFVzZXIuaWQ7CgogICAgICAgICAgICBpZiAoIShBdXRoU2VydmljZS5oYXNSZWZyZXNoVG9rZW4oKSAmJiAhY3VycmVudFVzZXJJZCkpIHsKICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMTU7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIF9jb250ZXh0LnByZXYgPSAyOwogICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gNTsKICAgICAgICAgICAgcmV0dXJuIEF1dGhTZXJ2aWNlLmRlYm91bmNlUmVmcmVzaFRva2VucygpOwoKICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDc7CiAgICAgICAgICAgIHJldHVybiAkc3RvcmUuZGlzcGF0Y2goJ3VzZXIvZ2V0Q3VycmVudCcpOwoKICAgICAgICAgIGNhc2UgNzoKICAgICAgICAgICAgbmV4dCgpOwogICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMTM7CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGNhc2UgMTA6CiAgICAgICAgICAgIF9jb250ZXh0LnByZXYgPSAxMDsKICAgICAgICAgICAgX2NvbnRleHQudDAgPSBfY29udGV4dFsiY2F0Y2giXSgyKTsKICAgICAgICAgICAgY29uc29sZS5sb2coX2NvbnRleHQudDApOwoKICAgICAgICAgIGNhc2UgMTM6CiAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAxNjsKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgY2FzZSAxNToKICAgICAgICAgICAgbmV4dCgpOwoKICAgICAgICAgIGNhc2UgMTY6CiAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuc3RvcCgpOwogICAgICAgIH0KICAgICAgfQogICAgfSwgX2NhbGxlZSwgbnVsbCwgW1syLCAxMF1dKTsKICB9KSk7CiAgcmV0dXJuIF9pbml0Q3VycmVudFVzZXJTdGF0ZU1pZGRsZXdhcmUuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKfQoKZXhwb3J0IGZ1bmN0aW9uIGNoZWNrQWNjZXNzTWlkZGxld2FyZSh0bywgZnJvbSwgbmV4dCkgewogIHZhciBjdXJyZW50VXNlcklkID0gJHN0b3JlLnN0YXRlLnVzZXIuY3VycmVudFVzZXIuaWQ7CiAgdmFyIGlzQXV0aFJvdXRlID0gdG8ubWF0Y2hlZC5zb21lKGZ1bmN0aW9uIChyZWNvcmQpIHsKICAgIHJldHVybiByZWNvcmQubWV0YS5yZXF1aXJlc0F1dGg7CiAgfSk7CgogIGlmIChpc0F1dGhSb3V0ZSkgewogICAgaWYgKGN1cnJlbnRVc2VySWQpIHsKICAgICAgaWYgKCEkc3RvcmUuc3RhdGUuZGF0YS51c2VkICYmIGNvb2tpZS5pc0tleSgiX2R0IiArIGN1cnJlbnRVc2VySWQpKSB7CiAgICAgICAgdmFyIGRhdGEgPSBjb29raWUuZ2V0KCJfZHQiICsgY3VycmVudFVzZXJJZCk7CgogICAgICAgIGlmICgkc3RvcmUuc3RhdGUuZGF0YS52ZXJzaW9uID09IGRhdGEudmVyc2lvbikgewogICAgICAgICAgJHN0b3JlLmNvbW1pdCgnZGF0YS9TZXRBbGxEYXRhJywgZGF0YSk7CiAgICAgICAgICAkc3RvcmUuY29tbWl0KCdkYXRhL1NldFVzZWRTdGF0ZScsIHRydWUpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIG5leHQoKTsKICAgIH0KCiAgICByZXR1cm4gbmV4dCgiL2xvZ2luIik7CiAgfQoKICB2YXIgaXNHdWVzdFJvdXRlID0gdG8ubWF0Y2hlZC5zb21lKGZ1bmN0aW9uIChyZWNvcmQpIHsKICAgIHJldHVybiByZWNvcmQubWV0YS5ndWVzdDsKICB9KTsKCiAgaWYgKGlzR3Vlc3RSb3V0ZSkgewogICAgaWYgKGN1cnJlbnRVc2VySWQpIHsKICAgICAgcmV0dXJuIG5leHQoIi9ob21lIik7CiAgICB9CgogICAgcmV0dXJuIG5leHQoKTsKICB9CgogIHJldHVybiBuZXh0KCk7Cn0KZXhwb3J0IGZ1bmN0aW9uIHNldFBhZ2VUaXRsZU1pZGRsZXdhcmUodG8sIGZyb20sIG5leHQpIHsKICB2YXIgcGFnZVRpdGxlID0gdG8ubWF0Y2hlZC5maW5kKGZ1bmN0aW9uIChyZWNvcmQpIHsKICAgIHJldHVybiByZWNvcmQubWV0YS50aXRsZTsKICB9KTsKICBpZiAocGFnZVRpdGxlKSB3aW5kb3cuZG9jdW1lbnQudGl0bGUgPSBwYWdlVGl0bGUubWV0YS50aXRsZTsKICBuZXh0KCk7Cn0="},{"version":3,"sources":["D:/projectFPT/SolidityProject/front-end/src/router/middlewares.js"],"names":["$store","AuthService","cookie","initCurrentUserStateMiddleware","to","from","next","currentUserId","state","user","currentUser","id","hasRefreshToken","debounceRefreshTokens","dispatch","console","log","checkAccessMiddleware","isAuthRoute","matched","some","record","meta","requiresAuth","data","used","isKey","get","version","commit","isGuestRoute","guest","setPageTitleMiddleware","pageTitle","find","title","window","document"],"mappings":";;;;AAAA,OAAOA,MAAP,MAAmB,UAAnB;AACA,SAASC,WAAT,QAA4B,oBAA5B;AACA,OAAOC,MAAP,MAAmB,aAAnB;AAEA,gBAAsBC,8BAAtB;AAAA;AAAA;;;4FAAO,iBAA+CC,EAA/C,EAAmDC,IAAnD,EAAyDC,IAAzD;AAAA;AAAA;AAAA;AAAA;AAAA;AACCC,YAAAA,aADD,GACiBP,MAAM,CAACQ,KAAP,CAAaC,IAAb,CAAkBC,WAAlB,CAA8BC,EAD/C;;AAAA,kBAGDV,WAAW,CAACW,eAAZ,MAAiC,CAACL,aAHjC;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA,mBAKKN,WAAW,CAACY,qBAAZ,EALL;;AAAA;AAAA;AAAA,mBAMKb,MAAM,CAACc,QAAP,CAAgB,iBAAhB,CANL;;AAAA;AAODR,YAAAA,IAAI;AAPH;AAAA;;AAAA;AAAA;AAAA;AASDS,YAAAA,OAAO,CAACC,GAAR;;AATC;AAAA;AAAA;;AAAA;AAYHV,YAAAA,IAAI;;AAZD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;;;AAgBP,OAAO,SAASW,qBAAT,CAAgCb,EAAhC,EAAoCC,IAApC,EAA0CC,IAA1C,EAAgD;AACrD,MAAMC,aAAa,GAAGP,MAAM,CAACQ,KAAP,CAAaC,IAAb,CAAkBC,WAAlB,CAA8BC,EAApD;AACA,MAAMO,WAAW,GAAGd,EAAE,CAACe,OAAH,CAAWC,IAAX,CAAgB,UAAAC,MAAM;AAAA,WAAIA,MAAM,CAACC,IAAP,CAAYC,YAAhB;AAAA,GAAtB,CAApB;;AAEA,MAAIL,WAAJ,EAAgB;AACV,QAAIX,aAAJ,EAAmB;AACjB,UAAI,CAACP,MAAM,CAACQ,KAAP,CAAagB,IAAb,CAAkBC,IAApB,IAA6BvB,MAAM,CAACwB,KAAP,CAAa,QAAMnB,aAAnB,CAAhC,EACA;AACE,YAAIiB,IAAI,GAAGtB,MAAM,CAACyB,GAAP,CAAW,QAAMpB,aAAjB,CAAX;;AACA,YAAGP,MAAM,CAACQ,KAAP,CAAagB,IAAb,CAAkBI,OAAlB,IAA6BJ,IAAI,CAACI,OAArC,EACA;AACE5B,UAAAA,MAAM,CAAC6B,MAAP,CAAc,iBAAd,EAAgCL,IAAhC;AACAxB,UAAAA,MAAM,CAAC6B,MAAP,CAAc,mBAAd,EAAkC,IAAlC;AACD;AACF;;AACD,aAAOvB,IAAI,EAAX;AACD;;AACD,WAAOA,IAAI,CAAC,QAAD,CAAX;AACL;;AAED,MAAMwB,YAAY,GAAG1B,EAAE,CAACe,OAAH,CAAWC,IAAX,CAAgB,UAAAC,MAAM;AAAA,WAAIA,MAAM,CAACC,IAAP,CAAYS,KAAhB;AAAA,GAAtB,CAArB;;AACA,MAAGD,YAAH,EACA;AACE,QAAIvB,aAAJ,EAAmB;AACf,aAAOD,IAAI,CAAC,OAAD,CAAX;AACD;;AACD,WAAOA,IAAI,EAAX;AACH;;AACD,SAAOA,IAAI,EAAX;AACD;AAED,OAAO,SAAS0B,sBAAT,CAAiC5B,EAAjC,EAAqCC,IAArC,EAA2CC,IAA3C,EAAiD;AACtD,MAAM2B,SAAS,GAAG7B,EAAE,CAACe,OAAH,CAAWe,IAAX,CAAgB,UAAAb,MAAM;AAAA,WAAIA,MAAM,CAACC,IAAP,CAAYa,KAAhB;AAAA,GAAtB,CAAlB;AAEA,MAAIF,SAAJ,EAAeG,MAAM,CAACC,QAAP,CAAgBF,KAAhB,GAAwBF,SAAS,CAACX,IAAV,CAAea,KAAvC;AACf7B,EAAAA,IAAI;AACL","sourcesContent":["import $store from '../store'\r\nimport { AuthService } from '@/services/auth.js'\r\nimport cookie from 'vue-cookies'\r\n\r\nexport async function initCurrentUserStateMiddleware (to, from, next) {\r\n  const currentUserId = $store.state.user.currentUser.id\r\n  \r\n  if (AuthService.hasRefreshToken() && !currentUserId) {\r\n    try {\r\n      await AuthService.debounceRefreshTokens()\r\n      await $store.dispatch('user/getCurrent')\r\n      next()\r\n    } catch (e) {\r\n      console.log(e)\r\n    }\r\n  } else {\r\n    next()\r\n  }  \r\n}\r\n\r\nexport function checkAccessMiddleware (to, from, next) {\r\n  const currentUserId = $store.state.user.currentUser.id\r\n  const isAuthRoute = to.matched.some(record => record.meta.requiresAuth)\r\n\r\n  if (isAuthRoute){\r\n        if (currentUserId) {\r\n          if((!$store.state.data.used) && cookie.isKey(\"_dt\"+currentUserId))\r\n          {\r\n            var data = cookie.get(\"_dt\"+currentUserId)\r\n            if($store.state.data.version == data.version)\r\n            {\r\n              $store.commit('data/SetAllData',data)\r\n              $store.commit('data/SetUsedState',true)\r\n            }\r\n          }\r\n          return next();\r\n        }\r\n        return next(\"/login\");\r\n  }\r\n\r\n  const isGuestRoute = to.matched.some(record => record.meta.guest)\r\n  if(isGuestRoute)\r\n  {\r\n    if (currentUserId) {\r\n        return next(\"/home\");\r\n      }\r\n      return next()\r\n  }\r\n  return next()\r\n}\r\n\r\nexport function setPageTitleMiddleware (to, from, next) {\r\n  const pageTitle = to.matched.find(record => record.meta.title)\r\n\r\n  if (pageTitle) window.document.title = pageTitle.meta.title\r\n  next()\r\n}"]}]}